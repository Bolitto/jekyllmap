---
layout: default
---

<div class="row main-content">
  <div class="col-md-3">
    <h2>All Locations</h2>
    <div class="list-group" id="listings">
    {% assign count = 0 %}{% for page in site.pages %}
      {% if page.layout == 'location' %}{% assign count = count | plus: 1 %}
      <a href="#{{count}}" class="list-group-item" data-toggle="collapse" data-target="#{{count}}" data-parent="#listings">{{ page.title }}</a>
      <div id="{{count}}" class="collapse">
        <p>{{ page.address }}</p>
        <p>{{ page.install_date }}</p>
      </div>
      {% endif %}
    {% endfor %}
    </div>
  </div>

  <div class="col-md-9">
    <div id="map" style="height: 600px;"></div>
  </div>
</div>

<script>
markerMap = {}
  // close any open items when clicking to show another
  //  and add .active to denote open element
  var point;
  $('.list-group-item').click(function() {
    $('div.in').collapse('hide');

    // if clicked the same element, remove highlight
    if ($(this).hasClass('active')) {
      $('.active').removeClass('active');
    }
    else {
      $('.active').removeClass('active');
      $(this).addClass('active')
    }
    

    // get count of element, remove beggining '#5' => '5'
    point = parseInt($(this).attr('data-target').substr(1,1));
    console.log('Point is: ' + point);

    var marker = markerMap[point];
    marker.openPopup();
  });


  // highlight listing item like it's being hovered over on map point hover
  function highlightListing(point) {
    listItem = "#" + point;
    // don't highlight if the point is current active item
    if (! $("a[data-target='" + listItem + "']").hasClass('active')) {
      $("a[data-target='" + listItem + "']").toggleClass('hover');
    }
  }

</script>

<script src="map.geojson"></script>
<script>

  var map = L.map('map').setView([37.78131, -122.42597], 13);

  var parkletIcon = L.AwesomeMarkers.icon({
    icon: 'coffee', 
    color: 'green'
  });

  var markers = new Array();
  var markerCount = 0;

  function onEachFeature(feature, layer) {
    var popupContent = document.createElement('div');
    popupContent.innerHTML = '<a href=' + feature.properties.url + '><strong>' + feature.properties.address + "</strong></a>";

    if (feature.properties.image) {
      popupContent.innerHTML += '<br /><img src="/images/' + feature.properties.image + '" height="200px">';
    }

    layer.bindPopup(popupContent);

    markerCount++;
    markers.push(markerCount);
    feature.properties.index = markerCount;

    layer.on({
        mouseover: hoverFeature,
        mouseout: unhoverFeature,
        mousedown: clickFeature
    });
  }

  function hoverFeature() {
    var point = this.feature.properties.index;
    highlightListing(point);
  }

  function unhoverFeature() {
    var point = this.feature.properties.index;
    highlightListing(point);
  }

  function clickFeature() {
    var point = this.feature.properties.index;
    highlightListing(point);
    $('a[href="#' + point + '"]').click();
  }


  L.tileLayer('http://{s}.tiles.mapbox.com/v3/examples.map-vyofok3q/{z}/{x}/{y}.png', {
    maxZoom: 18
  }).addTo(map);


  L.geoJson(data, {
    onEachFeature: onEachFeature,
    pointToLayer: function (feature, latlng) {

      var marker = new L.marker(latlng, {icon: parkletIcon});
      console.log("FEATURE ID: " + markers);
      markerMap[markers] = marker;
      return marker;

    }
  }).addTo(map);



</script>